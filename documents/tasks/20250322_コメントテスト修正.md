# コメントテスト修正

## 1. タスクの詳細

### タスク名
コメント関連テストのSKIP問題修正

### 目的
コメント関連のテスト（CMT-001〜CMT-011）がSKIPされている問題を解決し、テストが正常に実行されるようにする。

### 関連チケット
なし

### 優先度
中

## 2. 対応内容

以下の作業を実施しました：

1. **問題の調査**
   - コメント関連のテスト（test_comments.py）を確認
   - テストがSKIPされる条件を特定（発言データが存在しないため）
   - テストデータ作成スクリプト（create_test_data.py）を確認

2. **テストデータの作成**
   - `docker exec political-feed-api python -m tests.create_test_data` コマンドを実行
   - ユーザー、政党、政治家、トピック、発言、コメントのテストデータを作成
   - テストデータの作成が成功したことを確認

3. **テストの実行**
   - `docker exec political-feed-api python -m pytest tests/test_api/test_comments.py -v` コマンドを実行
   - すべてのコメント関連テスト（11個）が成功したことを確認

4. **自動テスト仕様書の更新**
   - テストデータの手動作成に関する情報を追加
   - コメント関連テストの実行方法を詳細に記載
   - テストデータ不足に関する問題と解決策を追加

## 3. 残課題

以下の課題が残っています：

1. **テストデータ作成の自動化**
   - 現在、テストデータは手動で作成する必要がある
   - conftest.pyを修正して、テスト実行前に自動的にテストデータを作成する仕組みを導入することが望ましい

2. **他のテストの失敗対応**
   - コメント関連テストは修正できたが、他のテスト（ユーザー関連、発言関連など）で失敗が発生している
   - 認証関連の問題やデータベースの状態管理の問題を解決する必要がある

3. **テスト実行の簡素化**
   - テスト実行前にテストデータを自動的に作成するスクリプトやMakefileを作成することが望ましい

## 4. 使用方法

### コメント関連テストの実行方法

1. **テストデータの作成**

   ```bash
   docker exec political-feed-api python -m tests.create_test_data
   ```

2. **コメント関連テストの実行**

   ```bash
   docker exec political-feed-api python -m pytest tests/test_api/test_comments.py -v
   ```

### 特定のテストのみを実行する場合

特定のテスト関数のみを実行する場合は、以下のコマンドを使用します：

```bash
docker exec political-feed-api python -m pytest tests/test_api/test_comments.py::test_get_statement_comments
```

### 注意事項

- テストを実行する前に、必ずテストデータを作成してください
- テストデータが不足している場合、テストがSKIPされる可能性があります
- テスト実行時に認証関連のエラーが発生した場合は、認証トークンの設定を確認してください